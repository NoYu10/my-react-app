(()=>{"use strict";({994:function(){var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}c((n=n.apply(e,t||[])).next())})};console.log("Service Worker initialized");let t=!1;const i=()=>{t?console.log("Service Worker already initialized"):(console.log("Initializing Service Worker..."),setTimeout(()=>{r(),t=!0,console.log("Service Worker initialization complete")},100))};let n=null;const o=()=>e(void 0,void 0,void 0,function*(){try{const e=yield chrome.storage.local.get(["flexTime_startTime","flexTime_targetHours","flexTime_targetMinutes","flexTime_breakStart","flexTime_breakEnd","flexTime_overtimeHours","flexTime_overtimeMinutes","flexTime_shortageHours","flexTime_shortageMinutes","notificationsAllowed","notificationShown","earlyLeaveNotificationShown"]),t=e.flexTime_startTime,i=e.flexTime_targetHours||6,n=e.flexTime_targetMinutes||0,o=e.flexTime_breakStart,r=e.flexTime_breakEnd,s=e.flexTime_overtimeHours||"",a=e.flexTime_overtimeMinutes||"",c=e.flexTime_shortageHours||"",l=e.flexTime_shortageMinutes||"",u="true"===e.notificationsAllowed,m="true"===e.notificationShown,f="true"===e.earlyLeaveNotificationShown;if(!u||!t)return;const d=(new Date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit",hour12:!1}),h=()=>{if(!t)return"--:--";const e=new Date,[s,a]=t.split(":");e.setHours(parseInt(s),parseInt(a),0,0);let c=0;if(o&&r){const e=new Date,[t,i]=o.split(":");e.setHours(parseInt(t),parseInt(i),0,0);const n=new Date,[s,a]=r.split(":");n.setHours(parseInt(s),parseInt(a),0,0),c=(n.getTime()-e.getTime())/36e5}const l=60*i+n,u=60*c;return new Date(e.getTime()+60*l*1e3+60*u*1e3).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit",hour12:!1})},g=()=>{const e=60*Number(s)+Number(a)-(60*Number(c)+Number(l));return{balanceInMinutes:e,isOvertime:e>0,hours:Math.floor(Math.abs(e)/60),minutes:Math.abs(e)%60}},p=()=>{const e=g();if(!e.isOvertime||!t)return null;const i=h();if("--:--"===i)return null;const[n,o]=i.split(":"),r=new Date;return r.setHours(parseInt(n),parseInt(o),0,0),new Date(r.getTime()-60*e.balanceInMinutes*1e3).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit",hour12:!1})},v=h(),T=p(),w=g();if(!m&&"--:--"!==v&&d===v){let e="推奨退勤時間になりました！";w.isOvertime||0===w.balanceInMinutes||(e+=`\n今月は${w.hours>0?`${w.hours}時間`:""}${w.minutes}分不足しています。`),e+="\n（通知を完全に止めるには設定から通知をオフにしてください）",chrome.notifications.create("end-time-notification",{type:"basic",iconUrl:"icon128.png",title:"フレックスタイム管理",message:e,requireInteraction:!0}),yield chrome.storage.local.set({notificationShown:"true"})}!f&&T&&d===T&&(chrome.notifications.create("early-leave-notification",{type:"basic",iconUrl:"icon128.png",title:"フレックスタイム管理",message:`${w.hours>0?`${w.hours}時間`:""}${w.minutes}分早く帰れます！\n（通知を完全に止めるには設定から通知をオフにしてください）`,requireInteraction:!0}),yield chrome.storage.local.set({earlyLeaveNotificationShown:"true"}))}catch(e){console.error("通知チェックエラー:",e)}}),r=()=>{try{n&&clearInterval(n),n=setInterval(o,6e4),o(),console.log("Notification check started successfully")}catch(e){console.error("Notification check start error:",e)}};chrome.runtime.onStartup.addListener(()=>{console.log("Extension startup - initializing service worker"),i()}),chrome.runtime.onInstalled.addListener(()=>{console.log("Extension installed - initializing service worker"),i()}),chrome.runtime.onSuspend.addListener(()=>{console.log("Extension suspended"),t=!1}),chrome.runtime.onSuspendCanceled.addListener(()=>{console.log("Extension suspend canceled - reinitializing service worker"),i()}),chrome.runtime.onMessage.addListener((e,t,n)=>{try{"startNotificationCheck"===e.action?(i(),n({success:!0,message:"Notification check started"})):"ping"===e.action?n({success:!0,message:"Service Worker is alive"}):n({success:!1,error:"Unknown action"})}catch(e){n({success:!1,error:"Unknown error"})}return!0}),chrome.notifications.onClicked.addListener(e=>{console.log("Notification clicked:",e),chrome.action.openPopup()}),chrome.notifications.onButtonClicked.addListener((e,t)=>{console.log("Notification button clicked:",e,t)})}})[994]()})();